<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Enhanced Meal Planner</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/vue/2.5.2/vue.min.js"></script>
    <!-- CDNJS :: Sortable (https://cdnjs.com/) -->
    <script src="//cdn.jsdelivr.net/npm/sortablejs@1.8.4/Sortable.min.js"></script>
    <!-- CDNJS :: Vue.Draggable (https://cdnjs.com/) -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/Vue.Draggable/2.20.0/vuedraggable.umd.min.js"></script>

    <style>
      body,
      html {
        height: 100%;
        overflow: hidden;
      }
      .scrollable {
        height: calc(100vh - 100px);
        overflow-y: auto;
      }
      .meal-section {
        min-height: 100px;
        border: 1px dashed #ccc;
        padding: 10px;
        margin-bottom: 10px;
      }
      .food-item {
        cursor: move;
        padding: 10px;
      }
      .food-item.in-meal {
        opacity: 0.5;
      }
    </style>
  </head>
  <body>
    <div id="app" class="container-fluid mt-4">
      <h1>Enhanced Meal Planner</h1>
      <div class="row">
        <div class="col-md-8 scrollable">
          <h2>Meals</h2>
          <div v-for="meal in meals" :key="meal.name">
            <h3>{{ meal.name }}</h3>
            <draggable :list="meal.items" group="foods" class="meal-section">
              <div
                v-for="item in meal.items"
                :key="item.name"
                class="food-item"
              >
                {{ item.name }} - Calories: {{ item.calories }}, Carbs: {{
                item.carbs }}g, Protein: {{ item.protein }}g, Fat: {{ item.fat
                }}g
                <button
                  @click="removeFromMeal(item, meal)"
                  class="btn btn-danger btn-sm float-end"
                >
                  Remove
                </button>
              </div>
            </draggable>
          </div>
        </div>
        <div class="col-md-4 scrollable">
          <h2>Favorite Foods</h2>
          <draggable :list="favoriteFoods" group="foods" class="list-group">
            <div
              v-for="item in favoriteFoods"
              :key="item.name"
              class="list-group-item food-item"
              :class="{ 'in-meal': isInMeal(item) }"
            >
              {{ item.name }} - Calories: {{ item.calories }}
              <button
                @click="removeFromFavorites(item)"
                class="btn btn-warning btn-sm float-end"
              >
                Unfavorite
              </button>
            </div>
          </draggable>

          <h2 class="mt-4">All Foods</h2>
          <draggable :list="enabledFoods" group="foods" class="list-group">
            <div
              v-for="item in enabledFoods"
              :key="item.name"
              class="list-group-item food-item"
              :class="{ 'in-meal': isInMeal(item) }"
            >
              {{ item.name }} - Calories: {{ item.calories }}
              <button
                @click="addToFavorites(item)"
                class="btn btn-success btn-sm float-end"
              >
                Favorite
              </button>
              <button
                @click="disableFood(item)"
                class="btn btn-secondary btn-sm float-end me-2"
              >
                Disable
              </button>
            </div>
          </draggable>

          <h2 class="mt-4">Disabled Foods</h2>
          <ul class="list-group">
            <li
              v-for="item in disabledFoods"
              :key="item.name"
              class="list-group-item"
            >
              {{ item.name }} - Calories: {{ item.calories }}
              <button
                @click="enableFood(item)"
                class="btn btn-info btn-sm float-end"
              >
                Enable
              </button>
            </li>
          </ul>

          <h2 class="mt-4">Nutrition Quota</h2>
          <ul class="list-group">
            <li class="list-group-item">
              Calories: {{ totalCalories }} / 2000
            </li>
            <li class="list-group-item">Protein: {{ totalProtein }}g / 150g</li>
            <li class="list-group-item">Carbs: {{ totalCarbs }}g / 225g</li>
            <li class="list-group-item">Fat: {{ totalFat }}g / 56g</li>
          </ul>
        </div>
      </div>
    </div>

    <script>
      const app = new Vue({
        el: "#app",
        data() {
          return {
            foods: {},
            meals: [
              { name: "Breakfast", items: [] },
              { name: "Lunch", items: [] },
              { name: "Dinner", items: [] },
            ],
            favoriteFoods: [],
          };
        },
        computed: {
          enabledFoods() {
            return Object.values(this.foods).filter(
              (food) => food.enabled && !this.favoriteFoods.includes(food)
            );
          },
          disabledFoods() {
            return Object.values(this.foods).filter((food) => !food.enabled);
          },
          totalCalories() {
            return this.meals.reduce(
              (sum, meal) =>
                sum +
                meal.items.reduce(
                  (mealSum, item) => mealSum + item.calories,
                  0
                ),
              0
            );
          },
          totalProtein() {
            return this.meals.reduce(
              (sum, meal) =>
                sum +
                meal.items.reduce((mealSum, item) => mealSum + item.protein, 0),
              0
            );
          },
          totalCarbs() {
            return this.meals.reduce(
              (sum, meal) =>
                sum +
                meal.items.reduce((mealSum, item) => mealSum + item.carbs, 0),
              0
            );
          },
          totalFat() {
            return this.meals.reduce(
              (sum, meal) =>
                sum +
                meal.items.reduce((mealSum, item) => mealSum + item.fat, 0),
              0
            );
          },
        },
        methods: {
          removeFromMeal(item, meal) {
            const index = meal.items.indexOf(item);
            if (index > -1) {
              meal.items.splice(index, 1);
            }
          },
          addToFavorites(item) {
            if (!this.favoriteFoods.includes(item)) {
              this.favoriteFoods.push(item);
            }
          },
          removeFromFavorites(item) {
            const index = this.favoriteFoods.indexOf(item);
            if (index > -1) {
              this.favoriteFoods.splice(index, 1);
            }
          },
          disableFood(item) {
            this.foods[item.name].enabled = false;
          },
          enableFood(item) {
            this.foods[item.name].enabled = true;
          },
          isInMeal(item) {
            return this.meals.some((meal) => meal.items.includes(item));
          },
        },
        mounted() {
          // Initialize with the provided JSON data
          this.foods = {
            "Kodiak Pancake": {
              calories: 317,
              carbs: 43.1,
              protein: 22.1,
              fat: 7.4,
              min_serving: 1,
              max_serving: 1,
              serving_step: 0.5,
              group: "",
              display_group: "Breakfast",
              required: false,
              enabled: true,
            },
            "Overnight Oats": {
              calories: 600,
              carbs: 94.5,
              protein: 29,
              fat: 12.8,
              min_serving: 0.5,
              max_serving: 1,
              serving_step: 0.5,
              group: "",
              display_group: "Breakfast",
              required: false,
              enabled: false,
            },
            Yogurt: {
              calories: 100,
              carbs: 7,
              protein: 18,
              fat: 0,
              min_serving: 0.5,
              max_serving: 1,
              serving_step: 0.5,
              group: "",
              display_group: "Breakfast",
              required: false,
              enabled: true,
            },
            "Soylent Powder": {
              calories: 400,
              carbs: 41,
              protein: 20,
              fat: 21,
              min_serving: 0.5,
              max_serving: 1,
              serving_step: 0.5,
              group: "proteinDrink",
              display_group: "Morning snack",
              required: false,
              enabled: true,
            },
            "Protein Powder": {
              calories: 120,
              carbs: 3,
              protein: 24,
              fat: 2,
              min_serving: 0.5,
              max_serving: 2.5,
              serving_step: 0.5,
              group: "",
              display_group: "Morning snack",
              required: false,
              enabled: true,
            },
            "Pasta & Chicken": {
              calories: 538,
              carbs: 46.3,
              protein: 47.9,
              fat: 16.8,
              min_serving: 1,
              max_serving: 1,
              serving_step: 0.5,
              group: "dinner",
              display_group: "Dinner",
              required: false,
              enabled: true,
            },
            "Faux Chipotle Bowl": {
              calories: 772,
              carbs: 82.7,
              protein: 53.5,
              fat: 24,
              min_serving: 1,
              max_serving: 1,
              serving_step: 0.5,
              group: "dinner",
              display_group: "Dinner",
              required: false,
              enabled: true,
            },
            "Kirkland Cookie Bar": {
              calories: 190,
              carbs: 22,
              protein: 21,
              fat: 7,
              min_serving: 1,
              max_serving: 1,
              serving_step: 0.5,
              group: "proteinBar",
              display_group: "Morning snack",
              required: true,
              enabled: true,
            },
            "Strawberries (100g)": {
              calories: 32,
              carbs: 7.6,
              protein: 0.6,
              fat: 0.3,
              min_serving: 0.5,
              max_serving: 1.5,
              serving_step: 0.5,
              group: "",
              display_group: "Breakfast",
              required: true,
              enabled: true,
            },
            "Sourdough (45g)": {
              calories: 110,
              carbs: 23,
              protein: 4,
              fat: 0.5,
              min_serving: 0.5,
              max_serving: 2.5,
              serving_step: 0.5,
              group: "",
              display_group: "Afternoon snack",
              required: false,
              enabled: true,
            },
            "Fairlife Protein Drink": {
              calories: 150,
              carbs: 4,
              protein: 30,
              fat: 2.5,
              min_serving: 1,
              max_serving: 1,
              serving_step: 0.5,
              group: "proteinDrink",
              display_group: "Morning snack",
              required: false,
              enabled: true,
            },
            "Collagen Peptides": {
              calories: 35,
              carbs: 0,
              protein: 18,
              fat: 0,
              min_serving: 0.5,
              max_serving: 0.5,
              serving_step: 0.5,
              group: "",
              display_group: "Morning snack",
              required: false,
              enabled: true,
            },
            "Clif Builder Bar": {
              calories: 290,
              carbs: 29,
              protein: 20,
              fat: 11,
              min_serving: 1,
              max_serving: 1,
              serving_step: 0.5,
              group: "proteinBar",
              display_group: "Morning snack",
              required: false,
              enabled: true,
            },
          };
          // Add name property to each food item
          for (let [name, food] of Object.entries(this.foods)) {
            food.name = name;
          }
        },
      });

      app.component("draggable", vuedraggable);
    //   app.mount("#app");
    </script>
  </body>
</html>
